---
title: Credentials Model
draft: false
---
---

Модель `Credentials` описывает учетные данные пользователя в проекте. Она используется для хранения информации о пароле, его версии, статусе подтверждения и связанных временных метках.

## Описание полей

| Поле                | Тип         | Описание                                            | Ограничения                          |
| ------------------- | ----------- | --------------------------------------------------- | ------------------------------------ |
| `id`                | `String`    | Уникальный идентификатор учетных данных             | `@id`, `@unique`, `@default(cuid())` |
| `version`           | `Int`       | Версия учетных данных, увеличивается автоматически  | `@default(autoincrement())`          |
| `lastPassword`      | `String?`   | Предыдущий пароль пользователя (может быть пустым)  | `@default("")`                       |
| `isConfirmed`       | `Boolean`   | Подтвержден ли пользователь (например, через email) | `@default(false)`                    |
| `updatedAt`         | `DateTime`  | Дата последнего обновления записи                   | `@updatedAt`                         |
| `passwordUpdatedAt` | `DateTime?` | Дата последнего обновления пароля (может быть null) | `@default(now())`                    |

## Отношения

### [[User]]
- **Тип связи**: Один-к-одному (опциональная)  
- **Описание**: Связывает учетные данные с моделью `[[User]]`. Поле `user` может быть пустым (опциональным), что обозначено как `User?`.  
- **Примечание**: Один пользователь может иметь только одну запись в `Credentials`, но связь необязательна (например, для пользователей с OAuth без локальных учетных данных).

## Код модели

```prisma
model Credentials {
  id    String   @id @unique @default(cuid())
  version   Int      @default(autoincrement()) 
  lastPassword String? @default("")
  isConfirmed Boolean @default(false)

  updatedAt DateTime @updatedAt
  passwordUpdatedAt DateTime? @default(now())

  user User?
}
```

---

## Особенности реализации

- **Генерация ID**: Поле `id` автоматически заполняется с помощью функции `cuid()` для уникальности и безопасности.  
- **Версионность**: Поле `version` автоматически увеличивается с каждым обновлением учетных данных, что полезно для отслеживания изменений.  
- **Предыдущий пароль**: Поле `lastPassword` хранит старый пароль (если есть), что может использоваться для проверки истории паролей.  
- **Подтверждение**: Поле `isConfirmed` указывает, подтвержден ли пользователь (например, через email или другой метод).  
- **Временные метки**: `updatedAt` обновляется автоматически при любом изменении, а `passwordUpdatedAt` фиксирует время смены пароля.

> [!NOTE]  
> Поле `lastPassword` полезно для реализации политики повторного использования паролей.

---

## Связи с другими заметками

- **[[User]]**: Модель пользователя, связанная с учетными данными.  

---

## Рекомендации

> [!WARNING]  
> Храните `lastPassword` в зашифрованном виде, как и основной пароль в [[User]], чтобы обеспечить безопасность.

- **Шифрование**: Используйте хеширование (например, bcrypt) для `lastPassword`, если он заполнен.  
- **Опционально**: Учитывайте, что связь с [[User]] опциональна — это полезно для пользователей, использующих только OAuth.  
- **Логика версий**: Используйте `version` для проверки актуальности учетных данных при обновлении.  
- **Тестирование**: Проверьте сценарии с неподтвержденными пользователями (`isConfirmed: false`) и без связи с `[[User]]`.

---

Эта заметка описывает модель `Credentials`, её структуру, отношения и примеры использования. Она интегрируется в документацию Obsidian через вики-ссылки и готова к дополнению новыми заметками.